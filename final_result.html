<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результаты Сортировки Ценностей</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f4f9;
            margin: 20px;
            color: #333;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .category {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .category h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .card {
            width: 220px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .card-top {
            background-color: #e0e0e0;
            padding: 10px;
            text-align: center;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid #ddd;
        }

        .card-bottom {
            background-color: #ffffff;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            color: #444;
        }

        .category:nth-child(1) h2 { color: #d3d3d3; } /* Не важные */
        .category:nth-child(2) h2 { color: #add8e6; } /* Немного важные */
        .category:nth-child(3) h2 { color: #90ee90; } /* Важные */
        .category:nth-child(4) h2 { color: #ffd700; } /* Очень важные */
        .category:nth-child(5) h2 { color: #ff4500; } /* Самые важные (ранжированные) */

        .buttons {
            text-align: center;
            margin: 20px 0;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            background-color: #28a745;
            color: #fff;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            h1 { font-size: 24px; }
            .card { width: 100%; max-width: 300px; }
        }

        @media (max-width: 480px) {
            .card { font-size: 12px; }
            .card-top, .card-bottom { padding: 8px; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <h1>Результаты Сортировки Ценностей</h1>

    <div class="container">
        <div id="results"></div>
    </div>

    <div class="buttons">
        <button id="download-excel">Скачать как Excel</button>
    </div>

    <script>
        // Загружаем данные из localStorage
        const savedGroups = JSON.parse(localStorage.getItem('values') || '{}');
        const rankedValues = JSON.parse(localStorage.getItem('ranked_values') || '[]');

        const resultsDiv = document.getElementById('results');

        // Функция для отображения карточек
        function displayCards(categoryName, cards) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category';
            categoryDiv.innerHTML = `<h2>${categoryName}</h2>`;
            const cardsDiv = document.createElement('div');
            cardsDiv.className = 'cards';

            cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.innerHTML = `
                    <div class="card-top">${card.top}</div>
                    <div class="card-bottom">${card.bottom}</div>
                `;
                cardsDiv.appendChild(cardElement);
            });

            categoryDiv.appendChild(cardsDiv);
            resultsDiv.appendChild(categoryDiv);
        }

        // Отображение всех категорий с полными названиями
        const categoryNames = {
            'Не': 'Не важные',
            'Немного': 'Немного важные',
            'Важные': 'Важные',
            'Очень': 'Очень важные',
            'Самые': 'Самые важные (ранжированные)' // Используем для отображения, но игнорируем дубли
        };

        // Отображаем все категории, исключая "Самые" если есть rankedValues
        Object.entries(savedGroups).forEach(([category, cards]) => {
            if (category !== 'Самые' || rankedValues.length === 0) {
                displayCards(categoryNames[category] || category, cards);
            }
        });

        // Отображаем "Самые важные (ранжированные)" только из rankedValues
        if (rankedValues.length > 0) {
            displayCards('Самые важные (ранжированные)', rankedValues);
        } else if (!savedGroups['Самые'] || savedGroups['Самые'].length === 0) {
            const noRankedDiv = document.createElement('div');
            noRankedDiv.className = 'category';
            noRankedDiv.innerHTML = `<h2>Самые важные (ранжированные)</h2><p>Нет данных о ранжировании.</p>`;
            resultsDiv.appendChild(noRankedDiv);
        }

        // Функция для экспорта в Excel
        document.getElementById('download-excel').addEventListener('click', () => {
            const wb = XLSX.utils.book_new();

            // Добавляем каждый лист из savedGroups, исключая "Самые" если есть rankedValues
            Object.entries(savedGroups).forEach(([category, cards]) => {
                if (category !== 'Самые' || rankedValues.length === 0) {
                    const wsData = [
                        ['Заголовок', 'Описание'],
                        ...cards.map(card => [card.top, card.bottom])
                    ];
                    const ws = XLSX.utils.aoa_to_sheet(wsData);
                    XLSX.utils.book_append_sheet(wb, ws, categoryNames[category] || category);
                }
            });

            // Добавляем лист для "Самые важные (ранжированные)" из rankedValues
            if (rankedValues.length > 0) {
                const wsData = [
                    ['Заголовок', 'Описание'],
                    ...rankedValues.map(card => [card.top, card.bottom])
                ];
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                XLSX.utils.book_append_sheet(wb, ws, 'Самые важные (ранжированные)');
            } else if (savedGroups['Самые'] && savedGroups['Самые'].length > 0) {
                const wsData = [
                    ['Заголовок', 'Описание'],
                    ...savedGroups['Самые'].map(card => [card.top, card.bottom])
                ];
                const ws = XLSX.utils.aoa_to_sheet(wsData);
                XLSX.utils.book_append_sheet(wb, ws, 'Самые важные (ранжированные)');
            }

            // Генерируем и скачиваем файл
            if (Object.keys(wb.Sheets).length > 0) {
                XLSX.writeFile(wb, 'results.xlsx');
            } else {
                alert('Нет данных для экспорта.');
            }
        });

        // Проверка загрузки SheetJS
        if (typeof XLSX === 'undefined') {
            console.error('SheetJS не загружен. Проверьте подключение к интернету или CDN.');
            alert('Ошибка: не удалось загрузить библиотеку для экспорта в Excel. Проверьте подключение к интернету.');
        }
    </script>
</body>
</html>